---
import { getFeaturedProducts } from '../data/products';
import { getProductsWithStock } from '../utils/stock';
import ProductLoader from './ProductLoader';

let featuredProducts: any[] = [];
let productsWithStock: any[] = [];

try {
  console.log('[FEATURED] Loading featured products...');
  featuredProducts = await getFeaturedProducts();
  console.log(`[FEATURED] ✅ Loaded ${featuredProducts.length} featured products`);
  productsWithStock = await getProductsWithStock(featuredProducts);
} catch (error: any) {
  console.error('[FEATURED] ❌ Error loading featured products:', error);
  console.error('[FEATURED] Error details:', {
    message: error.message,
    stack: error.stack,
  });
  // Continuar con array vacío - ProductLoader intentará cargar en el cliente
  productsWithStock = [];
}
---

<section class="bg-white py-24">
  <div class="mx-auto max-w-[1920px] px-6 lg:px-12">
    <div class="mb-16 text-center">
      <span class="text-xs font-normal uppercase tracking-[0.4em] text-black/60 mb-4 block">LO MEJOR DEL MES</span>
      <h2 class="text-4xl sm:text-5xl font-medium text-black tracking-[0.05em] font-display">DESTACADOS</h2>
    </div>
    
    <!-- Product Grid con fallback a carga en cliente -->
    <ProductLoader client:load initialProducts={productsWithStock} />
    
    <div class="mt-20 text-center">
      <a href="/catalogo" class="inline-flex h-12 items-center justify-center bg-black text-white px-10 text-xs font-light uppercase tracking-[0.2em] transition-all hover:bg-black/90">
        Ver Todo
      </a>
    </div>
  </div>
</section>
