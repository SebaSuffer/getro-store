---
import { getAllCategories } from '../utils/categories';

let categories: any[] = [];
const categoryImages: Record<string, string> = {};

try {
  categories = await getAllCategories();
  categories.forEach(cat => { categoryImages[cat.name] = cat.image_url; });
} catch (error: any) {
  console.error('[CATEGORIES-SECTION] Error:', error);
  categoryImages['Cadenas'] = 'https://res.cloudinary.com/ddzoh72zv/image/upload/f_auto,q_auto/v1766458847/DSC05016_dwuz7c.jpg';
  categoryImages['Pulseras'] = 'https://res.cloudinary.com/ddzoh72zv/image/upload/f_auto,q_auto/v1766458847/DSC05015_kiamyb.jpg';
  categoryImages['Anillos'] = 'https://res.cloudinary.com/ddzoh72zv/image/upload/f_auto,q_auto/v1766458847/DSC05014_tpyofl.jpg';
  categoryImages['Colgantes'] = 'https://res.cloudinary.com/ddzoh72zv/image/upload/f_auto,q_auto/v1766458846/DSC05010_zfxyxv.jpg';
  categoryImages['Aros'] = 'https://res.cloudinary.com/ddzoh72zv/image/upload/f_auto,q_auto/v1766458846/DSC05008_clyhgx.jpg';
  categoryImages['Esclavas'] = 'https://res.cloudinary.com/ddzoh72zv/image/upload/f_auto,q_auto/v1766458846/DSC05012_bbchhj.jpg';
  categories = Object.keys(categoryImages).map(name => ({ name, image_url: categoryImages[name], image_alt: name }));
}
---

<section id="categorias" class="bg-white py-32 scroll-mt-24">
  <div class="mx-auto max-w-[1920px] px-6 lg:px-12">
    <div class="mb-20 text-center">
      <span class="text-xs font-light uppercase tracking-[0.4em] text-black/60 mb-4 block">Explorar</span>
      <h2 class="text-4xl sm:text-5xl font-light text-black tracking-[0.05em] uppercase font-display">Categor√≠as</h2>
    </div>
    
    <div class="grid grid-cols-2 gap-6 sm:grid-cols-3 lg:grid-cols-6">
      {categories.map((category) => (
        <a href={`/catalogo?categoria=${encodeURIComponent(category.name)}`} class="group relative aspect-square overflow-hidden bg-black">
          <img
            src={category.image_url || categoryImages[category.name] || 'https://res.cloudinary.com/ddzoh72zv/image/upload/f_auto,q_auto/v1766458847/DSC05016_dwuz7c.jpg'}
            alt={category.image_alt || category.name}
            class="h-full w-full object-cover opacity-60 group-hover:opacity-80 transition-opacity duration-500"
            loading="lazy"
          />
          <div class="absolute inset-0 flex items-end p-6">
            <span class="text-white font-light uppercase tracking-[0.2em] text-xs font-display">{category.name}</span>
          </div>
        </a>
      ))}
    </div>
  </div>
</section>
