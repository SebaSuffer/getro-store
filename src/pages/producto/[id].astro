---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import ProductDetail from '../../components/ProductDetail';
import PaymentMethods from '../../components/PaymentMethods.astro';
import { getProductById, getAllProducts } from '../../data/products';

// Deshabilitar prerender porque necesitamos datos dinámicos de Turso
export const prerender = false;

const { id } = Astro.params;

if (!id) {
  return Astro.redirect('/catalogo');
}

// Cargar producto desde Turso
const product = await getProductById(id);

if (!product) {
  return Astro.redirect('/catalogo');
}
---

<BaseLayout 
  title={`${product.name} | GOTRA Joyería`}
  description={product.description || `Compra ${product.name} - ${product.category} de plata sólida 925. Envío gratis a todo Chile.`}
>
  <div class="relative flex h-auto min-h-screen w-full flex-col">
    <Header />
    
    <main class="flex-grow bg-white">
      <ProductDetail client:load product={product} />
      <PaymentMethods />
    </main>
    
    <Footer />
  </div>
</BaseLayout>

