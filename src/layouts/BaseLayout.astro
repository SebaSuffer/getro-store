---
import '../styles/globals.css';

interface Props {
  title?: string;
  description?: string;
}

const { title = 'GOTRA - Joyería Fina y Exclusiva', description = 'GOTRA - Joyería fina y exclusiva. Calidad premium y diseño elegante.' } = Astro.props;
---

<script is:inline>
  // Migrar productos editados con URLs antiguas a Cloudinary
  (function() {
    if (typeof window === 'undefined') return;
    
    try {
      const editedProducts = JSON.parse(localStorage.getItem('gotra_edited_products') || '{}');
      
      // Mapeo de IDs a nuevos nombres (actualización de nombres)
      const newNames = {
        '550e8400-e29b-41d4-a716-446655440001': 'Colgante Ala de Plata',
        '550e8400-e29b-41d4-a716-446655440002': 'Colgante Corona de Plata',
        '550e8400-e29b-41d4-a716-446655440003': 'Colgante Corona de Plata - Estilo Clásico',
        '550e8400-e29b-41d4-a716-446655440004': 'Colgante Cuadrado con Círculo de Plata',
        '550e8400-e29b-41d4-a716-446655440005': 'Colgante Cuadrado con Círculo de Plata - Grande',
        '550e8400-e29b-41d4-a716-446655440006': 'Colgante Cruz Estilizada de Plata',
        '550e8400-e29b-41d4-a716-446655440007': 'Colgante Cruz de Plata - Clásico',
        '550e8400-e29b-41d4-a716-446655440008': 'Colgante Diamante de Plata',
        '550e8400-e29b-41d4-a716-446655440009': 'Colgante Cruz de Plata',
        '550e8400-e29b-41d4-a716-446655440010': 'Colgante Cruz de Plata - Minimalista',
        '550e8400-e29b-41d4-a716-446655440011': 'Colgante Símbolo de Plata',
        '550e8400-e29b-41d4-a716-446655440012': 'Colgante Cruz de Plata - Tradicional',
      };
      
      // Actualizar nombres en productos editados
      let namesUpdated = false;
      for (const productId in editedProducts) {
        if (newNames[productId] && editedProducts[productId].name !== newNames[productId]) {
          editedProducts[productId].name = newNames[productId];
          editedProducts[productId].image_alt = newNames[productId];
          namesUpdated = true;
        }
      }
      
      const CLOUDINARY_BASE = 'https://res.cloudinary.com/ddzoh72zv/image/upload/f_auto,q_auto';
      const migrationMap = {
        '/images/dsc05016.jpg': CLOUDINARY_BASE + '/v1766458847/DSC05016_dwuz7c.jpg',
        '/images/dsc05015.jpg': CLOUDINARY_BASE + '/v1766458847/DSC05015_kiamyb.jpg',
        '/images/dsc05014.jpg': CLOUDINARY_BASE + '/v1766458847/DSC05014_tpyofl.jpg',
        '/images/dsc05013.jpg': CLOUDINARY_BASE + '/v1766458846/DSC05013_ls4kjv.jpg',
        '/images/dsc05012.jpg': CLOUDINARY_BASE + '/v1766458846/DSC05012_bbchhj.jpg',
        '/images/dsc05010.jpg': CLOUDINARY_BASE + '/v1766458846/DSC05010_zfxyxv.jpg',
        '/images/dsc05008.jpg': CLOUDINARY_BASE + '/v1766458846/DSC05008_clyhgx.jpg',
        '/images/dsc05007.jpg': CLOUDINARY_BASE + '/v1766458845/DSC05007_pbianr.jpg',
        '/images/dsc05006.jpg': CLOUDINARY_BASE + '/v1766458845/DSC05006_r56buj.jpg',
        '/images/dsc05005.jpg': CLOUDINARY_BASE + '/v1766458845/DSC05005_vz2ss2.jpg',
        '/images/dsc05004.jpg': CLOUDINARY_BASE + '/v1766458845/DSC05004_awkvea.jpg',
        '/images/dsc05003.jpg': CLOUDINARY_BASE + '/v1766458845/DSC05003_n0s54y.jpg',
        '/images/Mercado-Pago-Logo.png': CLOUDINARY_BASE + '/v1766458849/Mercado-Pago-Logo_kvhgin.png',
        '/images/Transbank-1200px-logo.png': CLOUDINARY_BASE + '/v1766458837/Transbank-1200px-logo_ljg48x.png',
        '/images/transferencia-logo.png': CLOUDINARY_BASE + '/v1766458838/transferencia-logo_fzj0gc.png',
      };
      
      let hasChanges = false;
      for (const productId in editedProducts) {
        const product = editedProducts[productId];
        if (product && product.image_url) {
          const oldUrl = product.image_url.toLowerCase();
          for (const [oldPath, newUrl] of Object.entries(migrationMap)) {
            if (oldUrl.includes(oldPath.toLowerCase())) {
              product.image_url = newUrl;
              hasChanges = true;
              break;
            }
          }
        }
      }
      
      if (hasChanges || namesUpdated) {
        localStorage.setItem('gotra_edited_products', JSON.stringify(editedProducts));
        if (namesUpdated) {
          console.log('✅ Nombres de productos actualizados en localStorage');
        }
        if (hasChanges) {
          console.log('✅ URLs de imágenes migradas a Cloudinary');
        }
      }
    } catch (error) {
      console.error('Error migrando productos:', error);
    }
  })();
</script>

<!DOCTYPE html>
<html lang="es" class="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="description" content={description} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;900&family=Cormorant+Garamond:wght@300;400;500;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
    <title>{title}</title>
    <slot name="head" />
  </head>
  <body class="bg-white text-black font-serif antialiased">
    <slot />
  </body>
</html>
